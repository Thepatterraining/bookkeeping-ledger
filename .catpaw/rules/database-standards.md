---
ruleType: Model Request
description: MySQL数据库设计和使用规范，包含表设计、索引、SQL编写等规约
globs:
---
rule编写规则: https://km.sankuai.com/collabpage/2710344014

# 数据库规范

## 命名规范

### 基本命名要求
- 【强制】数据库对象命名规范：数据库名、表名、字段名、索引名等只能使用小写字母、数字和下划线组合
- 【强制】索引命名规范：主键索引名为pk_字段名，唯一索引名为uk_字段名，普通索引名为idx_字段名
- 【建议】表名不使用复数名词，表名应该仅仅表示表里面的实体内容
- 【建议】表达是与否概念的字段命名：建议使用is_xxx/xxx_flag/xxx_status，数据类型使用TINYINT UNSIGNED

## 表设计规范

### 必备字段
- 【强制】每张表必须设置一个主键，推荐使用BIGINT UNSIGNED类型，自增
- 【强制】表必备三字段：
  - 主键，推荐使用BIGINT UNSIGNED类型，自增
  - 创建时间，DATETIME类型
  - 更新时间，DATETIME类型，建议设置默认值DEFAULT NOW() ON UPDATE CURRENT_TIMESTAMP

### 字段属性规范
- 【强制】表的所有字段原则上NOT NULL，并提供合理的默认值
- 【强制】小数类型使用DECIMAL，禁止使用FLOAT和DOUBLE
- 【强制】字符串类型选择：
  - 存储固定长度的字符串使用CHAR类型
  - VARCHAR是可变长字符串，长度不要超过5000
  - 超过5000的文本使用TEXT类型，并独立出来一张表

### 存储引擎和字符集
- 【强制】数据库和表必须使用InnoDB存储引擎并统一采用UTF8MB4字符集
- 【建议】单张表的列数量应当小于30列，若字段过多考虑按模块垂直拆分
- 【建议】单表行数超过500万行或者单表容量超过2GB，才推荐进行分库分表

### 其他设计原则
- 【强制】避免使用外键约束，由应用层保证数据一致性
- 【建议】逻辑删除替代物理删除，通过增加is_deleted字段实现
- 【强制】表和字段注释：每个数据库、数据表和字段都应当添加清晰的注释说明其含义

## 索引设计规范

### 索引创建原则
- 【强制】业务唯一性字段必须建立唯一索引，确保数据一致性
- 【强制】在VARCHAR字段上建立索引时必须指定索引长度，不要对整个字段建索引
- 【建议】创建复合索引时区分度最高的列放在最左边
- 【建议】利用延迟关联或子查询优化超多分页场景

### 索引使用注意事项
- 【建议】防止因字段类型不同造成的隐式转换，避免索引失效

## SQL编写规范

### 基本编写要求
- 【建议】SQL关键字和函数名必须使用大写，数据库对象名称使用小写
- 【强制】禁止使用SELECT *查询，SQL查询必须显式指定所需的列
- 【强制】INSERT语句必须指定字段列表，避免使用不带列名的INSERT

### SQL条件和操作
- 【强制】使用ISNULL()判断是否为NULL值
- 【强制】不要使用COUNT(列名)或COUNT(常量)替代COUNT(*)
- 【强制】UPDATE/DELETE必须带条件，禁止无条件的全表UPDATE或DELETE
- 【强制】禁止使用存储过程、触发器、事件调度等高级特性

### 性能优化建议
- 【建议】IN操作控制数量，IN后边的集合元素数量控制在200个之内
- 【建议】避免隐式转换导致索引失效
- 【建议】避免深分页，使用"WHERE id > ${上次的主键} LIMIT b"替代"LIMIT a,b"

## ORM映射规范

### MyBatis使用规范
- 【强制】查询不允许使用*作为查询的字段列表，需要哪些字段必须明确写明
- 【强制】SQL参数使用#{}，禁止使用${}防止SQL注入
- 【强制】不允许直接使用HashMap作为查询结果集输出

### 示例
```java
// 正确的查询方式
@Select("SELECT id, name, age FROM user WHERE id = #{id}")
User getById(Long id);

// 错误的查询方式
@Select("SELECT * FROM user WHERE id = ${id}")
User getById(Long id);
